function Animation(n){this.onStart=n.onStart||blankFunction,this.onFrame=n.onFrame||blankFunction,this.onStop=n.onStop||blankFunction,this.running=!1,this.frame=0}var reqAnimFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame,blankFunction=function(){};Animation.prototype={},Animation.prototype.start=function(){this.running=!0,this.onStart(),this.go()},Animation.prototype.go=function(){if(this.running){this.frame+=1;var n=this;reqAnimFrame(function(){n.go()}),this.onFrame(this.frame)}},Animation.prototype.stop=function(){this.running=!1,this.onStop()},Animation.prototype.pause=function(){this.running=!1},Animation.prototype.resume=function(){this.running=!0,this.go()},Game.prototype.updateMines=function(n){for(var e=0;e<this.mines.length;e++){var t=this.mines[e],i=distance(n.coords,t.coords);i<t.getWord().distance?(console.log("Mine levelled up:",t.getWord().text),t.levelUp(),g.views.updateMine(e)):g.views.updateMine(e,t.interpolateSize(i,t.level))}},window.$=function(n){var e="string"==typeof n?document.getElementById(n):n;return e?(e.text=function(n){return e.textContent=n,this},e.css=function(n){for(var t in n)e.style[t]=n[t];return this},e.hide=function(){return e.css({display:"none"}),this},e.show=function(){return e.css({display:""}),this},e.bind=function(n,t){return e.addEventListener("click",t),this},e):e},function(){function n(n){g.game=new Game(JSON.parse(n.game)),g.me=new Player(n.name),g.views.showGame()}function e(){setupSocket(i),i.bind("connect",function(){}),i.bind("disconnect",function(){}),i.bind("error",function(n){console.log("Error:",n),$("error").text(n)});for(var n in s)i.bind(n,s[n])}function t(){g.views.showIntro(),i=io({upgrade:!1,transports:["websocket"]});for(var n in a)$(n).bind("click",a[n]);e()}window.g=window.g||{},g.me=null,g.game=null;var i,o={startSignal:"new_game",name:"",code:""},r=function(n){o[n]=$("input-"+n).value},a={"game-new":function(){g.views.showNewGame()},"game-join":function(){o.startSignal="join_game",g.views.showJoinGame()},start:function(){["name","code"].forEach(r),i.emit(o.startSignal,o)}},s={player_joined:function(e){e.name===o.name?n(e):g.game.updateFromData(JSON.parse(e.game)),g.views.renderGame()}};window.addEventListener("load",t,!1)}();var keyAnims={},dirs={left:xy(-1,0),right:xy(1,0),up:xy(0,-1),down:xy(0,1)},inputControlMap={37:{onStart:function(){g.me.move(dirs.left)},onFrame:function(){g.me.move(dirs.left)}},39:{onStart:function(){g.me.move(dirs.right)},onFrame:function(){g.me.move(dirs.right)}},38:{onStart:function(){g.me.move(dirs.up)},onFrame:function(){g.me.move(dirs.up)}},40:{onStart:function(){g.me.move(dirs.down)},onFrame:function(){g.me.move(dirs.down)}}};window.addEventListener("keydown",function(n){var e=inputControlMap[n.which];if(e&&!keyAnims[n.which]){n.preventDefault();var t=new Animation(e);t.start(),keyAnims[n.which]=t}}),window.addEventListener("keyup",function(n){var e=keyAnims[n.which];e&&(n.preventDefault(),e.stop(),keyAnims[n.which]=null)}),distance=function(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))};var d0=100;Mine.prototype.getWord=function(n){return"undefined"==typeof n&&(n=this.level),this.words[Math.min(n,this.words.length-1)]},Mine.prototype.interpolateSize=function(n,e){var t=this.getWord(e);if(e>=this.words.length-1)return t.size;var i=0===e?{distance:t.distance+d0}:this.getWord(e-1),o=this.getWord(e+1),r=i.distance-t.distance,a=i.distance-n,s=a/r;return Math.max(t.size,t.size+(o.size-t.size)*s)};var velocity=5;Player.prototype.move=function(n){this.coords.x+=n.x*velocity,this.coords.y+=n.y*velocity,g.game.updateMines(g.me),g.views.updatePlayer()},window.g=window.g||{},g.views={},g.views.showIntro=function(){$("game").hide(),$("input-name").hide(),$("input-code").hide(),$("start").hide(),$("intro").show()},g.views.showNewGame=function(){$("game-new").hide(),$("game-join").hide(),$("input-name").show(),$("start").show()},g.views.showJoinGame=function(){$("game-new").hide(),$("game-join").hide(),$("input-name").show(),$("input-code").show(),$("start").show()},g.views.showGame=function(){$("intro").hide(),$("game").show()},g.views.renderGame=function(){$("players").text("team: "+_.mapProp(g.game.players,"name").join(", ")),$("code").text("game code: "+g.game.code);for(var n=0;n<g.game.mines.length;n++){var e=$(document.createElement("span"));e.className="mine",e.id="mine-"+n,$("gameplay").appendChild(e),g.views.updateMine(n)}g.views.updatePlayer()},g.views.updatePlayer=function(){$("player").show().css({left:g.me.coords.x+"px",top:g.me.coords.y+"px"})},g.views.updateMine=function(n,e){var t=$("mine-"+n),i=g.game.mines[n],o=i.getWord();e=e||o.size,t.text(o.text).css({"font-size":e+"px",left:i.coords.x+"px",top:i.coords.y+"px"})};
